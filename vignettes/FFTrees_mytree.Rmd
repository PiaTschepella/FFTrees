---
title: "Manually specifying FFTs"
author: "Nathaniel Phillips"
date: "`r Sys.Date()`"
output: rmarkdown::html_vignette
bibliography: fft.bib
csl: apa.csl 
vignette: >
  %\VignetteIndexEntry{Manually specifying FFTs}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, echo = FALSE}
knitr::opts_chunk$set(echo = TRUE, 
                      fig.width = 7.5, 
                      fig.height = 7.5, 
                      dpi = 100, 
                      out.width = "600px", 
                      fig.align='center', 
                      message = FALSE)
```


```{r load-pkg-0, echo = FALSE, message = FALSE, results = 'hide'}
library(FFTrees)
```


## Manually specifying FFTs 

We typically create fast-and-frugal trees (FFTs) from data by using the `FFTrees()` function (see the [Main guide](guide.html), the vignette on [Creating FFTs with FFTrees()](FFTrees_function.html) and for details). 
However, we sometimes want to design and test some specific FFT (e.g., to check a hypothesis or using some variables based on theoretical considerations). 

There are two ways to define fast-and-frugal trees manually when using the `FFTrees()` function: 

1. as a sentence using the `my.tree` argument (the easier way), or  

2. as a data frame using the `tree.definitions` argument (the harder way).  

Both of these methods will bypass the tree construction algorithms built into the **FFTrees** package.


### Using `my.tree`

The first method is to use the `my.tree` argument, where `my.tree` is a sentence describing a (single) FFT. When this argument is specified in `FFTrees()`, the function (specifically `wordstoFFT()` will try to extract the specified FFT from the argument.

For example, let's look at the columns `sex`, `age` and `thal` in the `heartdisease` data:

```{r heart-data}
head(heartdisease[c("sex", "age", "thal")])
```

Here's how we could specify an FFT using these cues as a sentence:

```{r fft-description, eval = FALSE}
my.tree = "If sex = 1, predict True.
           If age < 45, predict False. 
           If thal = {fd, normal}, predict True. Otherwise, predict False."
```

Here are some notes on specifying trees manually:

- Each node must start with the word "If" and should correspond to the form: `If <CUE> <DIRECTION> <THRESHOLD>, predict <EXIT>`.

- Numeric thresholds should be specified directly (without brackets). 

- Factor thresholds must be specified within curly braces like `sex = {male}`. 
For factors with sets of values, values within a threshold should be separated by commas like `eyecolor = {blue,brown}`. 

- Standard logical comparisons `=`, `!=`, `<`, `>=` (etc.) are valid. 
For numeric cues, only use `>`, `>=`, `<`, or\ `<=`. For factors, only use `=` or\ `!=`.

- Positive exits are indicated by `True`, while negative exits are specified by `False`. 
The final node will be forced to have a bi-directional exit. 
The text `Otherwise, predict EXIT` that we have included in the example above is actually not necessary. 

Now, let's pass the `my.tree` argument to `FFTrees()` to force apply our FFT to the `heartdisease` data:

```{r create-my-tree}
# Pass a verbally defined FFT to FFTrees with the my.tree argument: 
my_fft <- FFTrees(diagnosis ~.,
                  data = heartdisease,
                  my.tree = "If sex = 1, predict True.
                             If age < 45, predict False. 
                             If thal = {fd, normal}, predict True. 
                             Otherwise, predict False.")
```

Let's see how well our manually constructed FFT (`my_fft`) did:

```{r plot-my-tree, fig.cap="**Figure 1**: An FFT manually constructed using the `my.tree` argument of `FFTrees()`."}
# Plot an FFTrees object:
plot(my_fft)

# inwords(my_fft)
```

As we can see, this FFT is pretty bad --- it has a high sensitivity (of\ 85%), but suffers from a much lower specificity (of only\ 43%). 

Let's see if we can come up with a better FFT by using the cues\ `thal`, `cp`, and\ `ca`: 

```{r verbal-spec-fft, fig.cap="**Figure 2**: Another FFT manually constructed using the `my.tree` argument of `FFTrees()`."}
# Specify an alternative FFT with the my.tree argument: 
my_fft_2 <- FFTrees(diagnosis ~.,
                    data = heartdisease,
                    my.tree = "If thal = {rd,fd}, predict True.
                               If cp != {a}, predict False. 
                               If ca > 1, predict True. 
                               Otherwise, predict False.")

# Plot resulting FFT:
plot(my_fft_2)

# inwords(my_fft_2)
```

This alternative FFT (`my_fft_2`) performs a bit better, but is still far from perfect. 
So check out whether you can create even better ones! 


<!-- ToDo: 2nd way to specify an FFT:  -->

<!--       2. as a data frame using the `tree.definitions` argument  -->

```{r design-fft-df, echo = FALSE, eval = FALSE}
# Modify an existing FFT:
heart.fft <- FFTrees(formula = diagnosis ~ .,           # Criterion and (all) predictors
                     data = heart.train,                # Training data
                     data.test = heart.test,            # Testing data
                     main = "Heart Disease",            # General label
                     decision.labels = c("Low-Risk", "High-Risk"))  # Labels for decisions

# Current FFTs:
heart.fft$trees$definition

# Start from an existing FFT: 
my.fft <- heart.fft$trees$definitions[1, ]  

# Make some changes:
my.fft["tree"]  <- 8 
my.fft["exits"] <- c("1;1;0.5")

# Add to existing FFTs (as a new / 8th row):
heart.fft$trees$definition[8, ] <- my.fft
heart.fft$trees$n <- 8

# Use new FFT to predict same / new data:
predict(heart.fft, newdata = heartdisease, tree = 8)  # yields an ERROR...
```

See the section on **Tree definitions** in the [Creating FFTs with FFTrees()](FFTrees_function.html) vignette for details on understanding and changing tree definitions. 


## Vignettes

<!-- Table of all vignettes: -->

Here is a complete list of the vignettes available in the **FFTrees** package: 

|   | Vignette | Description |
|--:|:------------------------------|:-------------------------------------------------|
|   | [Main guide](guide.html) | An overview of the **FFTrees** package |
| 1 | [Heart Disease Tutorial](FFTrees_heart.html)   | An example of using `FFTrees()` to model heart disease diagnosis |
| 2 | [Accuracy statistics](FFTrees_accuracy_statistics.html) | Definitions of accuracy statistics used throughout the package |
| 3 | [Creating FFTs with FFTrees()](FFTrees_function.html) | Details on the main function `FFTrees()` |
| 4 | [Specifying FFTs directly](FFTrees_mytree.html)   | How to directly create FFTs with `my.tree` without using the built-in algorithms |
| 5 | [Visualizing FFTs with plot()](FFTrees_plot.html) | Plotting `FFTrees` objects, from full trees to icon arrays |
| 6 | [Examples of FFTs](FFTrees_examples.html) | Examples of FFTs from different datasets contained in the package |


<!-- eof. -->
